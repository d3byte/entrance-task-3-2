!function(e){var r={};function o(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=r,o.d=function(e,r,t){o.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,r){if(1&r&&(e=o(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var i in e)o.d(t,i,function(r){return e[r]}.bind(null,i));return t},o.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(r,"a",r),r},o.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},o.p="",o(o.s=0)}([function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=o(1),i=function(e){var r=[];e.map(function(e){if(r.includes(e.id))throw new Error("ID приборов должны быть уникальны");r.push(e.id)})};function n(e){if(!e.devices||!e.rates||!e.maxPower)throw new Error("Входные данные не соответствуют необходимой структуре");i(e.devices);var r={0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[],11:[],12:[],13:[],14:[],15:[],16:[],17:[],18:[],19:[],20:[],21:[],22:[],23:[]},o=new Array(24).fill(0),t={value:0,devices:{}},n=function(e,r){return e.sort(function(e,o){return e[r]>o[r]?-1:e[r]===o[r]?0:1})},u=function(e,r){void 0===r&&(r=4);var o=e.toFixed(r).toString();return"0"===o[o.length-1]?u(e,r-1):parseFloat(o)},a=n(e.devices,"duration"),d={night:[],day:[]};return e.rates.map(function(e){(e.from>=21||e.from<=7)&&(e.to>=21||e.to<=7)?d.night.push(e):d.day.push(e)}),d.night=n(d.night,"value").reverse(),d.day=n(d.day,"value").reverse(),a.map(function(i){var a=0;return t.devices[i.id]=0,"night"===i.mode?d.night.map(function(n){var u=n.from;if(n.to<n.from&&a<i.duration)for(;a<i.duration&&!(a>=i.duration);){24===u&&(u=0),o[u]+i.power<=e.maxPower&&(u>=n.to||u<n.to)&&!r[u].includes(i.id)&&(a++,o[u]+=i.power,r[u].push(i.id),t.value+=n.value*(i.power/1e3),t.devices[i.id]+=n.value*(i.power/1e3)),u++}else if(n.to>n.from&&a<i.duration)for(;a<i.duration&&!(a>=i.duration);){o[u]+i.power<=e.maxPower&&u>=n.from&&u<n.to&&!r[u].includes(i.id)&&(a++,o[u]+=i.power,r[u].push(i.id),t.value+=n.value*(i.power/1e3),t.devices[i.id]+=n.value*(i.power/1e3)),u++}}):"day"===i.mode?d.day.map(function(n){for(var u=n.from;u<n.to&&!(a>=i.duration);u++){o[u]+i.power<=e.maxPower&&u>=n.from&&u<n.to&&!r[u].includes(i.id)&&(a++,o[u]+=i.power,r[u].push(i.id),t.value+=n.value*(i.power/1e3),t.devices[i.id]+=n.value*(i.power/1e3))}}):i.mode||n(e.rates,"value").reverse().map(function(n){var u=n.from;if(n.to<n.from&&a<i.duration)for(;a<i.duration&&!(a>=i.duration);){if(24===u&&(u=0),!(o[u]+i.power<=e.maxPower)||!(u>=n.from||u<n.to)||r[u].includes(i.id))break;a++,o[u]+=i.power,r[u].push(i.id),t.value+=n.value*(i.power/1e3),t.devices[i.id]+=n.value*(i.power/1e3),u++}else if(n.to>n.from&&a<i.duration)for(;a<i.duration&&!(a>=i.duration);){if(!(o[u]+i.power<=e.maxPower&&u>=n.from&&u<n.to)||r[u].includes(i.id))break;a++,o[u]+=i.power,r[u].push(i.id),t.value+=n.value*(i.power/1e3),t.devices[i.id]+=n.value*(i.power/1e3),u++}}),t.devices[i.id]=u(t.devices[i.id]),i}),t.value=u(t.value),{schedule:r,consumedEnergy:t}}r.default=n;n(t.default)},function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default={devices:[{id:"F972B82BA56A70CC579945773B6866FB",name:"Посудомоечная машина",power:950,duration:3,mode:"night"},{id:"C515D887EDBBE669B2FDAC62F571E9E9",name:"Духовка",power:2e3,duration:2,mode:"day"},{id:"02DDD23A85DADDD71198305330CC386D",name:"Холодильник",power:50,duration:24},{id:"1E6276CC231716FE8EE8BC908486D41E",name:"Термостат",power:50,duration:24},{id:"7D9DC84AD110500D284B33C82FE6E85E",name:"Кондиционер",power:850,duration:1}],rates:[{from:7,to:10,value:6.46},{from:10,to:17,value:5.38},{from:17,to:21,value:6.46},{from:21,to:23,value:5.38},{from:23,to:7,value:1.79}],maxPower:2100}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovLy8uL3NyYy9kYXRhLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiZGF0YV8xIiwiY2hlY2tEZXZpY2VVbmlxdWVuZXNzIiwiZGV2aWNlcyIsImlkcyIsIm1hcCIsImRldmljZSIsImluY2x1ZGVzIiwiaWQiLCJFcnJvciIsInB1c2giLCJjcmVhdGVTY2hlZHVsZSIsImRhdGEiLCJyYXRlcyIsIm1heFBvd2VyIiwic2NoZWR1bGUiLCIwIiwiMSIsIjIiLCIzIiwiNCIsIjUiLCI2IiwiNyIsIjgiLCI5IiwiMTAiLCIxMSIsIjEyIiwiMTMiLCIxNCIsIjE1IiwiMTYiLCIxNyIsIjE4IiwiMTkiLCIyMCIsIjIxIiwiMjIiLCIyMyIsInNjaGVkdWxlSW5Qb3dlciIsIkFycmF5IiwiZmlsbCIsImNvbnN1bWVkRW5lcmd5Iiwic29ydEZpZWxkIiwiYXJyYXkiLCJzb3J0IiwiYSIsImIiLCJmaXhGbG9hdCIsIm51bWJlciIsInN0cmluZyIsInRvRml4ZWQiLCJ0b1N0cmluZyIsImxlbmd0aCIsInBhcnNlRmxvYXQiLCJzb3J0ZWREZXZpY2VzIiwibmlnaHQiLCJkYXkiLCJyYXRlIiwiZnJvbSIsInRvIiwicmV2ZXJzZSIsImhvdXJzU2NoZWR1bGVkIiwiaG91ciIsImR1cmF0aW9uIiwicG93ZXIiLCJkZWZhdWx0Il0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLElBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsWUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsR0FBMENLLFlBQUEsRUFBQUMsSUFBQUwsS0FLMUNaLEVBQUFrQixFQUFBLFNBQUFoQixHQUNBLG9CQUFBaUIsZUFBQUMsYUFDQU4sT0FBQUMsZUFBQWIsRUFBQWlCLE9BQUFDLGFBQXdEQyxNQUFBLFdBRXhEUCxPQUFBQyxlQUFBYixFQUFBLGNBQWlEbUIsT0FBQSxLQVFqRHJCLEVBQUFzQixFQUFBLFNBQUFELEVBQUFFLEdBRUEsR0FEQSxFQUFBQSxJQUFBRixFQUFBckIsRUFBQXFCLElBQ0EsRUFBQUUsRUFBQSxPQUFBRixFQUNBLEtBQUFFLEdBQUEsaUJBQUFGLFFBQUFHLFdBQUEsT0FBQUgsRUFDQSxJQUFBSSxFQUFBWCxPQUFBWSxPQUFBLE1BR0EsR0FGQTFCLEVBQUFrQixFQUFBTyxHQUNBWCxPQUFBQyxlQUFBVSxFQUFBLFdBQXlDVCxZQUFBLEVBQUFLLFVBQ3pDLEVBQUFFLEdBQUEsaUJBQUFGLEVBQUEsUUFBQU0sS0FBQU4sRUFBQXJCLEVBQUFVLEVBQUFlLEVBQUFFLEVBQUEsU0FBQUEsR0FBZ0gsT0FBQU4sRUFBQU0sSUFBcUJDLEtBQUEsS0FBQUQsSUFDckksT0FBQUYs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QUFPNEQsTUFBUSxLQUNyRHZCLEVBQWV4QyxRQUFRRyxFQUFPRSxLQUFPbUQsRUFBS3pFLE9BQVNvQixFQUFPNEQsTUFBUSxLQUt0RUYsT0FNaEJyQixFQUFleEMsUUFBUUcsRUFBT0UsSUFBTXlDLEVBQVNOLEVBQWV4QyxRQUFRRyxFQUFPRSxLQUVwRUYsSUFHWHFDLEVBQWV6RCxNQUFRK0QsRUFBU04sRUFBZXpELFFBRzNDNkIsU0FBUUEsRUFDUjRCLGVBQWNBLEdBek10QjVFLEVBQUFvRyxRQUFBeEQsRUE2TWVBLEVBQWVWLEVBQUFrRSx3RkN6TjlCcEcsRUFBQW9HLFNBQ0loRSxVQUVRSyxHQUFNLG1DQUNOaEMsS0FBUSx1QkFDUjBGLE1BQVMsSUFDVEQsU0FBWSxFQUNaN0UsS0FBUSxVQUdSb0IsR0FBTSxtQ0FDTmhDLEtBQVEsVUFDUjBGLE1BQVMsSUFDVEQsU0FBWSxFQUNaN0UsS0FBUSxRQUdSb0IsR0FBTSxtQ0FDTmhDLEtBQVEsY0FDUjBGLE1BQVMsR0FDVEQsU0FBWSxLQUdaekQsR0FBTSxtQ0FDTmhDLEtBQVEsWUFDUjBGLE1BQVMsR0FDVEQsU0FBWSxLQUdaekQsR0FBTSxtQ0FDTmhDLEtBQVEsY0FDUjBGLE1BQVMsSUFDVEQsU0FBWSxJQUdwQnBELFFBRVErQyxLQUFRLEVBQ1JDLEdBQU0sR0FDTjNFLE1BQVMsT0FHVDBFLEtBQVEsR0FDUkMsR0FBTSxHQUNOM0UsTUFBUyxPQUdUMEUsS0FBUSxHQUNSQyxHQUFNLEdBQ04zRSxNQUFTLE9BR1QwRSxLQUFRLEdBQ1JDLEdBQU0sR0FDTjNFLE1BQVMsT0FHVDBFLEtBQVEsR0FDUkMsR0FBTSxFQUNOM0UsTUFBUyxPQUdqQjRCLFNBQVkiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiaW1wb3J0IGRhdGEgZnJvbSAnLi9kYXRhJztcblxuY29uc3QgY2hlY2tEZXZpY2VVbmlxdWVuZXNzID0gZGV2aWNlcyA9PiB7XG4gICAgbGV0IGlkcyA9IFtdO1xuICAgIGRldmljZXMubWFwKGRldmljZSA9PiB7XG4gICAgICAgIGlmIChpZHMuaW5jbHVkZXMoZGV2aWNlLmlkKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJRCDQv9GA0LjQsdC+0YDQvtCyINC00L7Qu9C20L3RiyDQsdGL0YLRjCDRg9C90LjQutCw0LvRjNC90YsnKTtcbiAgICAgICAgfVxuICAgICAgICBpZHMucHVzaChkZXZpY2UuaWQpO1xuICAgIH0pO1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVTY2hlZHVsZShkYXRhKSB7XG4gICAgaWYgKCFkYXRhLmRldmljZXMgfHwgIWRhdGEucmF0ZXMgfHwgIWRhdGEubWF4UG93ZXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfQktGF0L7QtNC90YvQtSDQtNCw0L3QvdGL0LUg0L3QtSDRgdC+0L7RgtCy0LXRgtGB0YLQstGD0Y7RgiDQvdC10L7QsdGF0L7QtNC40LzQvtC5INGB0YLRgNGD0LrRgtGD0YDQtScpO1xuICAgIH1cblxuICAgIGNoZWNrRGV2aWNlVW5pcXVlbmVzcyhkYXRhLmRldmljZXMpO1xuXG4gICAgY29uc3Qgc2NoZWR1bGUgPSB7XG4gICAgICAgIFwiMFwiOiBbXSxcbiAgICAgICAgXCIxXCI6IFtdLFxuICAgICAgICBcIjJcIjogW10sXG4gICAgICAgIFwiM1wiOiBbXSxcbiAgICAgICAgXCI0XCI6IFtdLFxuICAgICAgICBcIjVcIjogW10sXG4gICAgICAgIFwiNlwiOiBbXSxcbiAgICAgICAgXCI3XCI6IFtdLFxuICAgICAgICBcIjhcIjogW10sXG4gICAgICAgIFwiOVwiOiBbXSxcbiAgICAgICAgXCIxMFwiOiBbXSxcbiAgICAgICAgXCIxMVwiOiBbXSxcbiAgICAgICAgXCIxMlwiOiBbXSxcbiAgICAgICAgXCIxM1wiOiBbXSxcbiAgICAgICAgXCIxNFwiOiBbXSxcbiAgICAgICAgXCIxNVwiOiBbXSxcbiAgICAgICAgXCIxNlwiOiBbXSxcbiAgICAgICAgXCIxN1wiOiBbXSxcbiAgICAgICAgXCIxOFwiOiBbXSxcbiAgICAgICAgXCIxOVwiOiBbXSxcbiAgICAgICAgXCIyMFwiOiBbXSxcbiAgICAgICAgXCIyMVwiOiBbXSxcbiAgICAgICAgXCIyMlwiOiBbXSxcbiAgICAgICAgXCIyM1wiOiBbXVxuICAgIH07XG4gICAgY29uc3Qgc2NoZWR1bGVJblBvd2VyID0gbmV3IEFycmF5KDI0KS5maWxsKDApO1xuXG4gICAgY29uc3QgY29uc3VtZWRFbmVyZ3kgPSB7XG4gICAgICAgIFwidmFsdWVcIjogMCxcbiAgICAgICAgXCJkZXZpY2VzXCI6IHt9LFxuICAgIH07XG5cbiAgICBjb25zdCBzb3J0RmllbGQgPSAoYXJyYXk6IGFueVtdLCBrZXkpID0+IGFycmF5LnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgaWYgKGFba2V5XSA+IGJba2V5XSkge1xuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9IGVsc2UgaWYgKGFba2V5XSA9PT0gYltrZXldKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBmaXhGbG9hdCA9IChudW1iZXI6IG51bWJlciwgbiA9IDQpID0+IHtcbiAgICAgICAgY29uc3Qgc3RyaW5nID0gbnVtYmVyLnRvRml4ZWQobikudG9TdHJpbmcoKTtcbiAgICAgICAgaWYgKHN0cmluZ1tzdHJpbmcubGVuZ3RoIC0gMV0gPT09ICcwJykge1xuICAgICAgICAgICAgcmV0dXJuIGZpeEZsb2F0KG51bWJlciwgbiAtIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoc3RyaW5nKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgICAgIFxuXG4gICAgbGV0IHNvcnRlZERldmljZXMgPSBzb3J0RmllbGQoZGF0YS5kZXZpY2VzLCAnZHVyYXRpb24nKTtcblxuICAgIGNvbnN0IHJhdGVzID0ge1xuICAgICAgICBuaWdodDogW10sXG4gICAgICAgIGRheTogW11cbiAgICB9O1xuXG4gICAgZGF0YS5yYXRlcy5tYXAocmF0ZSA9PiB7XG4gICAgICAgIGlmICgocmF0ZS5mcm9tID49IDIxIHx8IHJhdGUuZnJvbSA8PSA3KSAmJiAocmF0ZS50byA+PSAyMSB8fCByYXRlLnRvIDw9IDcpKSB7XG4gICAgICAgICAgICByYXRlcy5uaWdodC5wdXNoKHJhdGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmF0ZXMuZGF5LnB1c2gocmF0ZSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHJhdGVzLm5pZ2h0ID0gc29ydEZpZWxkKHJhdGVzLm5pZ2h0LCAndmFsdWUnKS5yZXZlcnNlKCk7XG4gICAgcmF0ZXMuZGF5ID0gc29ydEZpZWxkKHJhdGVzLmRheSwgJ3ZhbHVlJykucmV2ZXJzZSgpO1xuXG4gICAgc29ydGVkRGV2aWNlcy5tYXAoZGV2aWNlID0+IHtcbiAgICAgICAgbGV0IGhvdXJzU2NoZWR1bGVkID0gMDtcbiAgICAgICAgY29uc3VtZWRFbmVyZ3kuZGV2aWNlc1tkZXZpY2UuaWRdID0gMDtcbiAgICAgICAgaWYgKGRldmljZS5tb2RlID09PSAnbmlnaHQnKSB7XG4gICAgICAgICAgICByYXRlcy5uaWdodC5tYXAocmF0ZSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGhvdXIgPSByYXRlLmZyb207XG4gICAgICAgICAgICAgICAgaWYgKHJhdGUudG8gPCByYXRlLmZyb20gJiYgaG91cnNTY2hlZHVsZWQgPCBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGhvdXJzU2NoZWR1bGVkIDwgZGV2aWNlLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaG91cnNTY2hlZHVsZWQgPj0gZGV2aWNlLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaG91ciA9PT0gMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzRW5vdWdoUG93ZXIgPSBzY2hlZHVsZUluUG93ZXJbaG91cl0gKyBkZXZpY2UucG93ZXIgPD0gZGF0YS5tYXhQb3dlcjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc0Vub3VnaFBvd2VyICYmIChob3VyID49IHJhdGUudG8gfHwgaG91ciA8IHJhdGUudG8pICYmICFzY2hlZHVsZVtob3VyXS5pbmNsdWRlcyhkZXZpY2UuaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91cnNTY2hlZHVsZWQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZUluUG93ZXJbaG91cl0gKz0gZGV2aWNlLnBvd2VyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlW2hvdXJdLnB1c2goZGV2aWNlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lZEVuZXJneS52YWx1ZSArPSByYXRlLnZhbHVlICogKGRldmljZS5wb3dlciAvIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVkRW5lcmd5LmRldmljZXNbZGV2aWNlLmlkXSArPSByYXRlLnZhbHVlICogKGRldmljZS5wb3dlciAvIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaG91cisrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyYXRlLnRvID4gcmF0ZS5mcm9tICYmIGhvdXJzU2NoZWR1bGVkIDwgZGV2aWNlLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaG91cnNTY2hlZHVsZWQgPCBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChob3Vyc1NjaGVkdWxlZCA+PSBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzRW5vdWdoUG93ZXIgPSBzY2hlZHVsZUluUG93ZXJbaG91cl0gKyBkZXZpY2UucG93ZXIgPD0gZGF0YS5tYXhQb3dlcjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc0Vub3VnaFBvd2VyICYmIChob3VyID49IHJhdGUuZnJvbSAmJiBob3VyIDwgcmF0ZS50bykgJiYgIXNjaGVkdWxlW2hvdXJdLmluY2x1ZGVzKGRldmljZS5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Vyc1NjaGVkdWxlZCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlSW5Qb3dlcltob3VyXSArPSBkZXZpY2UucG93ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVbaG91cl0ucHVzaChkZXZpY2UuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVkRW5lcmd5LnZhbHVlICs9IHJhdGUudmFsdWUgKiAoZGV2aWNlLnBvd2VyIC8gMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRFbmVyZ3kuZGV2aWNlc1tkZXZpY2UuaWRdICs9IHJhdGUudmFsdWUgKiAoZGV2aWNlLnBvd2VyIC8gMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBob3VyKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChkZXZpY2UubW9kZSA9PT0gJ2RheScpIHtcbiAgICAgICAgICAgIHJhdGVzLmRheS5tYXAocmF0ZSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaG91ciA9IHJhdGUuZnJvbTsgaG91ciA8IHJhdGUudG87IGhvdXIrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaG91cnNTY2hlZHVsZWQgPj0gZGV2aWNlLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Vub3VnaFBvd2VyID0gc2NoZWR1bGVJblBvd2VyW2hvdXJdICsgZGV2aWNlLnBvd2VyIDw9IGRhdGEubWF4UG93ZXI7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc0Vub3VnaFBvd2VyICYmIGhvdXIgPj0gcmF0ZS5mcm9tICYmIGhvdXIgPCByYXRlLnRvICYmICFzY2hlZHVsZVtob3VyXS5pbmNsdWRlcyhkZXZpY2UuaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBob3Vyc1NjaGVkdWxlZCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVJblBvd2VyW2hvdXJdICs9IGRldmljZS5wb3dlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlW2hvdXJdLnB1c2goZGV2aWNlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVkRW5lcmd5LnZhbHVlICs9IHJhdGUudmFsdWUgKiAoZGV2aWNlLnBvd2VyIC8gMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lZEVuZXJneS5kZXZpY2VzW2RldmljZS5pZF0gKz0gcmF0ZS52YWx1ZSAqIChkZXZpY2UucG93ZXIgLyAxMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0gZWxzZSBpZiAoIWRldmljZS5tb2RlKSB7XG4gICAgICAgICAgICBzb3J0RmllbGQoZGF0YS5yYXRlcywgJ3ZhbHVlJykucmV2ZXJzZSgpLm1hcChyYXRlID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgaG91ciA9IHJhdGUuZnJvbTtcbiAgICAgICAgICAgICAgICBpZiAocmF0ZS50byA8IHJhdGUuZnJvbSAmJiBob3Vyc1NjaGVkdWxlZCA8IGRldmljZS5kdXJhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaG91cnNTY2hlZHVsZWQgPCBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChob3Vyc1NjaGVkdWxlZCA+PSBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChob3VyID09PSAyNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXIgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNFbm91Z2hQb3dlciA9IHNjaGVkdWxlSW5Qb3dlcltob3VyXSArIGRldmljZS5wb3dlciA8PSBkYXRhLm1heFBvd2VyO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzRW5vdWdoUG93ZXIgJiYgKGhvdXIgPj0gcmF0ZS5mcm9tIHx8IGhvdXIgPCByYXRlLnRvKSAmJiAhc2NoZWR1bGVbaG91cl0uaW5jbHVkZXMoZGV2aWNlLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzU2NoZWR1bGVkKys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVJblBvd2VyW2hvdXJdICs9IGRldmljZS5wb3dlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZVtob3VyXS5wdXNoKGRldmljZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRFbmVyZ3kudmFsdWUgKz0gcmF0ZS52YWx1ZSAqIChkZXZpY2UucG93ZXIgLyAxMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lZEVuZXJneS5kZXZpY2VzW2RldmljZS5pZF0gKz0gcmF0ZS52YWx1ZSAqIChkZXZpY2UucG93ZXIgLyAxMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBob3VyKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhdGUudG8gPiByYXRlLmZyb20gJiYgaG91cnNTY2hlZHVsZWQgPCBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGhvdXJzU2NoZWR1bGVkIDwgZGV2aWNlLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaG91cnNTY2hlZHVsZWQgPj0gZGV2aWNlLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Vub3VnaFBvd2VyID0gc2NoZWR1bGVJblBvd2VyW2hvdXJdICsgZGV2aWNlLnBvd2VyIDw9IGRhdGEubWF4UG93ZXI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNFbm91Z2hQb3dlciAmJiAoaG91ciA+PSByYXRlLmZyb20gJiYgaG91ciA8IHJhdGUudG8pICYmICFzY2hlZHVsZVtob3VyXS5pbmNsdWRlcyhkZXZpY2UuaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91cnNTY2hlZHVsZWQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZUluUG93ZXJbaG91cl0gKz0gZGV2aWNlLnBvd2VyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlW2hvdXJdLnB1c2goZGV2aWNlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lZEVuZXJneS52YWx1ZSArPSByYXRlLnZhbHVlICogKGRldmljZS5wb3dlciAvIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVkRW5lcmd5LmRldmljZXNbZGV2aWNlLmlkXSArPSByYXRlLnZhbHVlICogKGRldmljZS5wb3dlciAvIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaG91cisrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN1bWVkRW5lcmd5LmRldmljZXNbZGV2aWNlLmlkXSA9IGZpeEZsb2F0KGNvbnN1bWVkRW5lcmd5LmRldmljZXNbZGV2aWNlLmlkXSk7XG4vLyBcbiAgICAgICAgcmV0dXJuIGRldmljZVxuICAgIH0pXG5cbiAgICBjb25zdW1lZEVuZXJneS52YWx1ZSA9IGZpeEZsb2F0KGNvbnN1bWVkRW5lcmd5LnZhbHVlKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgICBzY2hlZHVsZSxcbiAgICAgICAgY29uc3VtZWRFbmVyZ3lcbiAgICB9O1xufVxuXG5jb25zdCByZXN1bHQgPSBjcmVhdGVTY2hlZHVsZShkYXRhKTsiLCJleHBvcnQgZGVmYXVsdCB7XG4gICAgXCJkZXZpY2VzXCI6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgXCJpZFwiOiBcIkY5NzJCODJCQTU2QTcwQ0M1Nzk5NDU3NzNCNjg2NkZCXCIsXG4gICAgICAgICAgICBcIm5hbWVcIjogXCLQn9C+0YHRg9C00L7QvNC+0LXRh9C90LDRjyDQvNCw0YjQuNC90LBcIixcbiAgICAgICAgICAgIFwicG93ZXJcIjogOTUwLFxuICAgICAgICAgICAgXCJkdXJhdGlvblwiOiAzLFxuICAgICAgICAgICAgXCJtb2RlXCI6IFwibmlnaHRcIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBcImlkXCI6IFwiQzUxNUQ4ODdFREJCRTY2OUIyRkRBQzYyRjU3MUU5RTlcIixcbiAgICAgICAgICAgIFwibmFtZVwiOiBcItCU0YPRhdC+0LLQutCwXCIsXG4gICAgICAgICAgICBcInBvd2VyXCI6IDIwMDAsXG4gICAgICAgICAgICBcImR1cmF0aW9uXCI6IDIsXG4gICAgICAgICAgICBcIm1vZGVcIjogXCJkYXlcIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBcImlkXCI6IFwiMDJEREQyM0E4NURBRERENzExOTgzMDUzMzBDQzM4NkRcIixcbiAgICAgICAgICAgIFwibmFtZVwiOiBcItCl0L7Qu9C+0LTQuNC70YzQvdC40LpcIixcbiAgICAgICAgICAgIFwicG93ZXJcIjogNTAsXG4gICAgICAgICAgICBcImR1cmF0aW9uXCI6IDI0XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIFwiaWRcIjogXCIxRTYyNzZDQzIzMTcxNkZFOEVFOEJDOTA4NDg2RDQxRVwiLFxuICAgICAgICAgICAgXCJuYW1lXCI6IFwi0KLQtdGA0LzQvtGB0YLQsNGCXCIsXG4gICAgICAgICAgICBcInBvd2VyXCI6IDUwLFxuICAgICAgICAgICAgXCJkdXJhdGlvblwiOiAyNFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBcImlkXCI6IFwiN0Q5REM4NEFEMTEwNTAwRDI4NEIzM0M4MkZFNkU4NUVcIixcbiAgICAgICAgICAgIFwibmFtZVwiOiBcItCa0L7QvdC00LjRhtC40L7QvdC10YBcIixcbiAgICAgICAgICAgIFwicG93ZXJcIjogODUwLFxuICAgICAgICAgICAgXCJkdXJhdGlvblwiOiAxXG4gICAgICAgIH1cbiAgICBdLFxuICAgIFwicmF0ZXNcIjogW1xuICAgICAgICB7XG4gICAgICAgICAgICBcImZyb21cIjogNyxcbiAgICAgICAgICAgIFwidG9cIjogMTAsXG4gICAgICAgICAgICBcInZhbHVlXCI6IDYuNDZcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgXCJmcm9tXCI6IDEwLFxuICAgICAgICAgICAgXCJ0b1wiOiAxNyxcbiAgICAgICAgICAgIFwidmFsdWVcIjogNS4zOFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBcImZyb21cIjogMTcsXG4gICAgICAgICAgICBcInRvXCI6IDIxLFxuICAgICAgICAgICAgXCJ2YWx1ZVwiOiA2LjQ2XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIFwiZnJvbVwiOiAyMSxcbiAgICAgICAgICAgIFwidG9cIjogMjMsXG4gICAgICAgICAgICBcInZhbHVlXCI6IDUuMzhcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgXCJmcm9tXCI6IDIzLFxuICAgICAgICAgICAgXCJ0b1wiOiA3LFxuICAgICAgICAgICAgXCJ2YWx1ZVwiOiAxLjc5XG4gICAgICAgIH0sXG4gICAgXSxcbiAgICBcIm1heFBvd2VyXCI6IDIxMDBcbn07Il0sInNvdXJjZVJvb3QiOiIifQ==