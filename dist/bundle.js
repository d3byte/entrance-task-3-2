!function(e){var r={};function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,r,t){o.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,r){if(1&r&&(e=o(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)o.d(t,n,function(r){return e[r]}.bind(null,n));return t},o.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(r,"a",r),r},o.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},o.p="",o(o.s=0)}([function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=o(1),n=function(e){var r=[];e.map(function(e){if(r.includes(e.id))throw new Error("ID приборов должны быть уникальны");r.push(e.id)})};function i(e){if(!e.devices||!e.rates||!e.maxPower)throw new Error("Входные данные не соответствуют необходимой структуре");n(e.devices);var r={0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[],11:[],12:[],13:[],14:[],15:[],16:[],17:[],18:[],19:[],20:[],21:[],22:[],23:[]},o=new Array(24).fill(0),t={value:0,devices:{}},i=function(e,r){return e.sort(function(e,o){return e[r]>o[r]?-1:e[r]===o[r]?0:1})},u=function(e,r){void 0===r&&(r=4);var o=e.toFixed(r).toString();return"0"===o[o.length-1]?u(e,r-1):parseFloat(o)},a=i(e.devices,"duration"),d={night:[],day:[]};return e.rates.map(function(e){(e.from>=21||e.from<=7)&&(e.to>=21||e.to<=7)?d.night.push(e):d.day.push(e)}),d.night=i(d.night,"value").reverse(),d.day=i(d.day,"value").reverse(),a.map(function(n){var a=0;return t.devices[n.id]=0,"night"===n.mode?d.night.map(function(i){var u=i.from;if(i.to<i.from&&a<n.duration)for(;a<n.duration&&!(a>=n.duration);){24===u&&(u=0),o[u]+n.power<=e.maxPower&&(u>=i.to||u<i.to)&&!r[u].includes(n.id)&&(a++,o[u]+=n.power,r[u].push(n.id),t.value+=i.value*(n.power/1e3),t.devices[n.id]+=i.value*(n.power/1e3)),u++}else if(i.to>i.from&&a<n.duration)for(;a<n.duration&&!(a>=n.duration);){o[u]+n.power<=e.maxPower&&u>=i.from&&u<i.to&&!r[u].includes(n.id)&&(a++,o[u]+=n.power,r[u].push(n.id),t.value+=i.value*(n.power/1e3),t.devices[n.id]+=i.value*(n.power/1e3)),u++}}):"day"===n.mode?d.day.map(function(i){for(var u=i.from;u<i.to&&!(a>=n.duration);u++){o[u]+n.power<=e.maxPower&&u>=i.from&&u<i.to&&!r[u].includes(n.id)&&(a++,o[u]+=n.power,r[u].push(n.id),t.value+=i.value*(n.power/1e3),t.devices[n.id]+=i.value*(n.power/1e3))}}):n.mode||i(e.rates,"value").reverse().map(function(i){var u=i.from;if(i.to<i.from&&a<n.duration)for(;a<n.duration&&!(a>=n.duration);){if(24===u&&(u=0),!(o[u]+n.power<=e.maxPower)||!(u>=i.from||u<i.to)||r[u].includes(n.id))break;a++,o[u]+=n.power,r[u].push(n.id),t.value+=i.value*(n.power/1e3),t.devices[n.id]+=i.value*(n.power/1e3),u++}else if(i.to>i.from&&a<n.duration)for(;a<n.duration&&!(a>=n.duration);){if(!(o[u]+n.power<=e.maxPower&&u>=i.from&&u<i.to)||r[u].includes(n.id))break;a++,o[u]+=n.power,r[u].push(n.id),t.value+=i.value*(n.power/1e3),t.devices[n.id]+=i.value*(n.power/1e3),u++}}),t.devices[n.id]=u(t.devices[n.id]),n}),t.value=u(t.value),{schedule:r,consumedEnergy:t}}r.default=i;var u=i(t.default);console.log(u)},function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default={devices:[{id:"F972B82BA56A70CC579945773B6866FB",name:"Посудомоечная машина",power:950,duration:3,mode:"night"},{id:"C515D887EDBBE669B2FDAC62F571E9E9",name:"Духовка",power:2e3,duration:2,mode:"day"},{id:"02DDD23A85DADDD71198305330CC386D",name:"Холодильник",power:50,duration:24},{id:"1E6276CC231716FE8EE8BC908486D41E",name:"Термостат",power:50,duration:24},{id:"7D9DC84AD110500D284B33C82FE6E85E",name:"Кондиционер",power:850,duration:1}],rates:[{from:7,to:10,value:6.46},{from:10,to:17,value:5.38},{from:17,to:21,value:6.46},{from:21,to:23,value:5.38},{from:23,to:7,value:1.79}],maxPower:2100}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovLy8uL3NyYy9kYXRhLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiZGF0YV8xIiwiY2hlY2tEZXZpY2VVbmlxdWVuZXNzIiwiZGV2aWNlcyIsImlkcyIsIm1hcCIsImRldmljZSIsImluY2x1ZGVzIiwiaWQiLCJFcnJvciIsInB1c2giLCJjcmVhdGVTY2hlZHVsZSIsImRhdGEiLCJyYXRlcyIsIm1heFBvd2VyIiwic2NoZWR1bGUiLCIwIiwiMSIsIjIiLCIzIiwiNCIsIjUiLCI2IiwiNyIsIjgiLCI5IiwiMTAiLCIxMSIsIjEyIiwiMTMiLCIxNCIsIjE1IiwiMTYiLCIxNyIsIjE4IiwiMTkiLCIyMCIsIjIxIiwiMjIiLCIyMyIsInNjaGVkdWxlSW5Qb3dlciIsIkFycmF5IiwiZmlsbCIsImNvbnN1bWVkRW5lcmd5Iiwic29ydEZpZWxkIiwiYXJyYXkiLCJzb3J0IiwiYSIsImIiLCJmaXhGbG9hdCIsIm51bWJlciIsInN0cmluZyIsInRvRml4ZWQiLCJ0b1N0cmluZyIsImxlbmd0aCIsInBhcnNlRmxvYXQiLCJzb3J0ZWREZXZpY2VzIiwibmlnaHQiLCJkYXkiLCJyYXRlIiwiZnJvbSIsInRvIiwicmV2ZXJzZSIsImhvdXJzU2NoZWR1bGVkIiwiaG91ciIsImR1cmF0aW9uIiwicG93ZXIiLCJkZWZhdWx0IiwicmVzdWx0IiwiY29uc29sZSIsImxvZyJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDWixFQUFBa0IsRUFBQSxTQUFBaEIsR0FDQSxvQkFBQWlCLGVBQUFDLGFBQ0FOLE9BQUFDLGVBQUFiLEVBQUFpQixPQUFBQyxhQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQXJCLEVBQUFxQixJQUNBLEVBQUFFLEVBQUEsT0FBQUYsRUFDQSxLQUFBRSxHQUFBLGlCQUFBRixRQUFBRyxXQUFBLE9BQUFILEVBQ0EsSUFBQUksRUFBQVgsT0FBQVksT0FBQSxNQUdBLEdBRkExQixFQUFBa0IsRUFBQU8sR0FDQVgsT0FBQUMsZUFBQVUsRUFBQSxXQUF5Q1QsWUFBQSxFQUFBSyxVQUN6QyxFQUFBRSxHQUFBLGlCQUFBRixFQUFBLFFBQUFNLEtBQUFOLEVBQUFyQixFQUFBVSxFQUFBZSxFQUFBRSxFQUFBLFNBQUFBLEdBQWdILE9BQUFOLEVBQUFNLElBQXFC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ekQsT0FBU3lFLEVBQUt6RSxPQUFTb0IsRUFBTzRELE1BQVEsS0FDckR2QixFQUFleEMsUUFBUUcsRUFBT0UsS0FBT21ELEVBQUt6RSxPQUFTb0IsRUFBTzRELE1BQVEsS0FLdEVGLE9BTWhCckIsRUFBZXhDLFFBQVFHLEVBQU9FLElBQU15QyxFQUFTTixFQUFleEMsUUFBUUcsRUFBT0UsS0FFcEVGLElBR1hxQyxFQUFlekQsTUFBUStELEVBQVNOLEVBQWV6RCxRQUczQzZCLFNBQVFBLEVBQ1I0QixlQUFjQSxHQXpNdEI1RSxFQUFBb0csUUFBQXhELEVBNk1BLElBQU15RCxFQUFTekQsRUFBZVYsRUFBQWtFLFNBRTlCRSxRQUFRQyxJQUFJRixrRkMzTlpyRyxFQUFBb0csU0FDSWhFLFVBRVFLLEdBQU0sbUNBQ05oQyxLQUFRLHVCQUNSMEYsTUFBUyxJQUNURCxTQUFZLEVBQ1o3RSxLQUFRLFVBR1JvQixHQUFNLG1DQUNOaEMsS0FBUSxVQUNSMEYsTUFBUyxJQUNURCxTQUFZLEVBQ1o3RSxLQUFRLFFBR1JvQixHQUFNLG1DQUNOaEMsS0FBUSxjQUNSMEYsTUFBUyxHQUNURCxTQUFZLEtBR1p6RCxHQUFNLG1DQUNOaEMsS0FBUSxZQUNSMEYsTUFBUyxHQUNURCxTQUFZLEtBR1p6RCxHQUFNLG1DQUNOaEMsS0FBUSxjQUNSMEYsTUFBUyxJQUNURCxTQUFZLElBR3BCcEQsUUFFUStDLEtBQVEsRUFDUkMsR0FBTSxHQUNOM0UsTUFBUyxPQUdUMEUsS0FBUSxHQUNSQyxHQUFNLEdBQ04zRSxNQUFTLE9BR1QwRSxLQUFRLEdBQ1JDLEdBQU0sR0FDTjNFLE1BQVMsT0FHVDBFLEtBQVEsR0FDUkMsR0FBTSxHQUNOM0UsTUFBUyxPQUdUMEUsS0FBUSxHQUNSQyxHQUFNLEVBQ04zRSxNQUFTLE9BR2pCNEIsU0FBWSIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJpbXBvcnQgZGF0YSBmcm9tICcuL2RhdGEnO1xuXG5jb25zdCBjaGVja0RldmljZVVuaXF1ZW5lc3MgPSBkZXZpY2VzID0+IHtcbiAgICBsZXQgaWRzID0gW107XG4gICAgZGV2aWNlcy5tYXAoZGV2aWNlID0+IHtcbiAgICAgICAgaWYgKGlkcy5pbmNsdWRlcyhkZXZpY2UuaWQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0lEINC/0YDQuNCx0L7RgNC+0LIg0LTQvtC70LbQvdGLINCx0YvRgtGMINGD0L3QuNC60LDQu9GM0L3RiycpO1xuICAgICAgICB9XG4gICAgICAgIGlkcy5wdXNoKGRldmljZS5pZCk7XG4gICAgfSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZVNjaGVkdWxlKGRhdGEpIHtcbiAgICBpZiAoIWRhdGEuZGV2aWNlcyB8fCAhZGF0YS5yYXRlcyB8fCAhZGF0YS5tYXhQb3dlcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ9CS0YXQvtC00L3Ri9C1INC00LDQvdC90YvQtSDQvdC1INGB0L7QvtGC0LLQtdGC0YHRgtCy0YPRjtGCINC90LXQvtCx0YXQvtC00LjQvNC+0Lkg0YHRgtGA0YPQutGC0YPRgNC1Jyk7XG4gICAgfVxuXG4gICAgY2hlY2tEZXZpY2VVbmlxdWVuZXNzKGRhdGEuZGV2aWNlcyk7XG5cbiAgICBjb25zdCBzY2hlZHVsZSA9IHtcbiAgICAgICAgXCIwXCI6IFtdLFxuICAgICAgICBcIjFcIjogW10sXG4gICAgICAgIFwiMlwiOiBbXSxcbiAgICAgICAgXCIzXCI6IFtdLFxuICAgICAgICBcIjRcIjogW10sXG4gICAgICAgIFwiNVwiOiBbXSxcbiAgICAgICAgXCI2XCI6IFtdLFxuICAgICAgICBcIjdcIjogW10sXG4gICAgICAgIFwiOFwiOiBbXSxcbiAgICAgICAgXCI5XCI6IFtdLFxuICAgICAgICBcIjEwXCI6IFtdLFxuICAgICAgICBcIjExXCI6IFtdLFxuICAgICAgICBcIjEyXCI6IFtdLFxuICAgICAgICBcIjEzXCI6IFtdLFxuICAgICAgICBcIjE0XCI6IFtdLFxuICAgICAgICBcIjE1XCI6IFtdLFxuICAgICAgICBcIjE2XCI6IFtdLFxuICAgICAgICBcIjE3XCI6IFtdLFxuICAgICAgICBcIjE4XCI6IFtdLFxuICAgICAgICBcIjE5XCI6IFtdLFxuICAgICAgICBcIjIwXCI6IFtdLFxuICAgICAgICBcIjIxXCI6IFtdLFxuICAgICAgICBcIjIyXCI6IFtdLFxuICAgICAgICBcIjIzXCI6IFtdXG4gICAgfTtcbiAgICBjb25zdCBzY2hlZHVsZUluUG93ZXIgPSBuZXcgQXJyYXkoMjQpLmZpbGwoMCk7XG5cbiAgICBjb25zdCBjb25zdW1lZEVuZXJneSA9IHtcbiAgICAgICAgXCJ2YWx1ZVwiOiAwLFxuICAgICAgICBcImRldmljZXNcIjoge30sXG4gICAgfTtcblxuICAgIGNvbnN0IHNvcnRGaWVsZCA9IChhcnJheTogYW55W10sIGtleSkgPT4gYXJyYXkuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICBpZiAoYVtrZXldID4gYltrZXldKSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH0gZWxzZSBpZiAoYVtrZXldID09PSBiW2tleV0pIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IGZpeEZsb2F0ID0gKG51bWJlcjogbnVtYmVyLCBuID0gNCkgPT4ge1xuICAgICAgICBjb25zdCBzdHJpbmcgPSBudW1iZXIudG9GaXhlZChuKS50b1N0cmluZygpO1xuICAgICAgICBpZiAoc3RyaW5nW3N0cmluZy5sZW5ndGggLSAxXSA9PT0gJzAnKSB7XG4gICAgICAgICAgICByZXR1cm4gZml4RmxvYXQobnVtYmVyLCBuIC0gMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzdHJpbmcpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAgICAgXG5cbiAgICBsZXQgc29ydGVkRGV2aWNlcyA9IHNvcnRGaWVsZChkYXRhLmRldmljZXMsICdkdXJhdGlvbicpO1xuXG4gICAgY29uc3QgcmF0ZXMgPSB7XG4gICAgICAgIG5pZ2h0OiBbXSxcbiAgICAgICAgZGF5OiBbXVxuICAgIH07XG5cbiAgICBkYXRhLnJhdGVzLm1hcChyYXRlID0+IHtcbiAgICAgICAgaWYgKChyYXRlLmZyb20gPj0gMjEgfHwgcmF0ZS5mcm9tIDw9IDcpICYmIChyYXRlLnRvID49IDIxIHx8IHJhdGUudG8gPD0gNykpIHtcbiAgICAgICAgICAgIHJhdGVzLm5pZ2h0LnB1c2gocmF0ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByYXRlcy5kYXkucHVzaChyYXRlKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmF0ZXMubmlnaHQgPSBzb3J0RmllbGQocmF0ZXMubmlnaHQsICd2YWx1ZScpLnJldmVyc2UoKTtcbiAgICByYXRlcy5kYXkgPSBzb3J0RmllbGQocmF0ZXMuZGF5LCAndmFsdWUnKS5yZXZlcnNlKCk7XG5cbiAgICBzb3J0ZWREZXZpY2VzLm1hcChkZXZpY2UgPT4ge1xuICAgICAgICBsZXQgaG91cnNTY2hlZHVsZWQgPSAwO1xuICAgICAgICBjb25zdW1lZEVuZXJneS5kZXZpY2VzW2RldmljZS5pZF0gPSAwO1xuICAgICAgICBpZiAoZGV2aWNlLm1vZGUgPT09ICduaWdodCcpIHtcbiAgICAgICAgICAgIHJhdGVzLm5pZ2h0Lm1hcChyYXRlID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgaG91ciA9IHJhdGUuZnJvbTtcbiAgICAgICAgICAgICAgICBpZiAocmF0ZS50byA8IHJhdGUuZnJvbSAmJiBob3Vyc1NjaGVkdWxlZCA8IGRldmljZS5kdXJhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaG91cnNTY2hlZHVsZWQgPCBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChob3Vyc1NjaGVkdWxlZCA+PSBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChob3VyID09PSAyNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXIgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNFbm91Z2hQb3dlciA9IHNjaGVkdWxlSW5Qb3dlcltob3VyXSArIGRldmljZS5wb3dlciA8PSBkYXRhLm1heFBvd2VyO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzRW5vdWdoUG93ZXIgJiYgKGhvdXIgPj0gcmF0ZS50byB8fCBob3VyIDwgcmF0ZS50bykgJiYgIXNjaGVkdWxlW2hvdXJdLmluY2x1ZGVzKGRldmljZS5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Vyc1NjaGVkdWxlZCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlSW5Qb3dlcltob3VyXSArPSBkZXZpY2UucG93ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVbaG91cl0ucHVzaChkZXZpY2UuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVkRW5lcmd5LnZhbHVlICs9IHJhdGUudmFsdWUgKiAoZGV2aWNlLnBvd2VyIC8gMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRFbmVyZ3kuZGV2aWNlc1tkZXZpY2UuaWRdICs9IHJhdGUudmFsdWUgKiAoZGV2aWNlLnBvd2VyIC8gMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBob3VyKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhdGUudG8gPiByYXRlLmZyb20gJiYgaG91cnNTY2hlZHVsZWQgPCBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChob3Vyc1NjaGVkdWxlZCA8IGRldmljZS5kdXJhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhvdXJzU2NoZWR1bGVkID49IGRldmljZS5kdXJhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNFbm91Z2hQb3dlciA9IHNjaGVkdWxlSW5Qb3dlcltob3VyXSArIGRldmljZS5wb3dlciA8PSBkYXRhLm1heFBvd2VyO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzRW5vdWdoUG93ZXIgJiYgKGhvdXIgPj0gcmF0ZS5mcm9tICYmIGhvdXIgPCByYXRlLnRvKSAmJiAhc2NoZWR1bGVbaG91cl0uaW5jbHVkZXMoZGV2aWNlLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzU2NoZWR1bGVkKys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVJblBvd2VyW2hvdXJdICs9IGRldmljZS5wb3dlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZVtob3VyXS5wdXNoKGRldmljZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRFbmVyZ3kudmFsdWUgKz0gcmF0ZS52YWx1ZSAqIChkZXZpY2UucG93ZXIgLyAxMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lZEVuZXJneS5kZXZpY2VzW2RldmljZS5pZF0gKz0gcmF0ZS52YWx1ZSAqIChkZXZpY2UucG93ZXIgLyAxMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGhvdXIrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKGRldmljZS5tb2RlID09PSAnZGF5Jykge1xuICAgICAgICAgICAgcmF0ZXMuZGF5Lm1hcChyYXRlID0+IHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBob3VyID0gcmF0ZS5mcm9tOyBob3VyIDwgcmF0ZS50bzsgaG91cisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChob3Vyc1NjaGVkdWxlZCA+PSBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzRW5vdWdoUG93ZXIgPSBzY2hlZHVsZUluUG93ZXJbaG91cl0gKyBkZXZpY2UucG93ZXIgPD0gZGF0YS5tYXhQb3dlcjtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaGFzRW5vdWdoUG93ZXIgJiYgaG91ciA+PSByYXRlLmZyb20gJiYgaG91ciA8IHJhdGUudG8gJiYgIXNjaGVkdWxlW2hvdXJdLmluY2x1ZGVzKGRldmljZS5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhvdXJzU2NoZWR1bGVkKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZUluUG93ZXJbaG91cl0gKz0gZGV2aWNlLnBvd2VyO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVbaG91cl0ucHVzaChkZXZpY2UuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRFbmVyZ3kudmFsdWUgKz0gcmF0ZS52YWx1ZSAqIChkZXZpY2UucG93ZXIgLyAxMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVkRW5lcmd5LmRldmljZXNbZGV2aWNlLmlkXSArPSByYXRlLnZhbHVlICogKGRldmljZS5wb3dlciAvIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSBlbHNlIGlmICghZGV2aWNlLm1vZGUpIHtcbiAgICAgICAgICAgIHNvcnRGaWVsZChkYXRhLnJhdGVzLCAndmFsdWUnKS5yZXZlcnNlKCkubWFwKHJhdGUgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBob3VyID0gcmF0ZS5mcm9tO1xuICAgICAgICAgICAgICAgIGlmIChyYXRlLnRvIDwgcmF0ZS5mcm9tICYmIGhvdXJzU2NoZWR1bGVkIDwgZGV2aWNlLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChob3Vyc1NjaGVkdWxlZCA8IGRldmljZS5kdXJhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhvdXJzU2NoZWR1bGVkID49IGRldmljZS5kdXJhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhvdXIgPT09IDI0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91ciA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Vub3VnaFBvd2VyID0gc2NoZWR1bGVJblBvd2VyW2hvdXJdICsgZGV2aWNlLnBvd2VyIDw9IGRhdGEubWF4UG93ZXI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNFbm91Z2hQb3dlciAmJiAoaG91ciA+PSByYXRlLmZyb20gfHwgaG91ciA8IHJhdGUudG8pICYmICFzY2hlZHVsZVtob3VyXS5pbmNsdWRlcyhkZXZpY2UuaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91cnNTY2hlZHVsZWQrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZUluUG93ZXJbaG91cl0gKz0gZGV2aWNlLnBvd2VyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlW2hvdXJdLnB1c2goZGV2aWNlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1lZEVuZXJneS52YWx1ZSArPSByYXRlLnZhbHVlICogKGRldmljZS5wb3dlciAvIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVkRW5lcmd5LmRldmljZXNbZGV2aWNlLmlkXSArPSByYXRlLnZhbHVlICogKGRldmljZS5wb3dlciAvIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGhvdXIrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmF0ZS50byA+IHJhdGUuZnJvbSAmJiBob3Vyc1NjaGVkdWxlZCA8IGRldmljZS5kdXJhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaG91cnNTY2hlZHVsZWQgPCBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChob3Vyc1NjaGVkdWxlZCA+PSBkZXZpY2UuZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzRW5vdWdoUG93ZXIgPSBzY2hlZHVsZUluUG93ZXJbaG91cl0gKyBkZXZpY2UucG93ZXIgPD0gZGF0YS5tYXhQb3dlcjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc0Vub3VnaFBvd2VyICYmIChob3VyID49IHJhdGUuZnJvbSAmJiBob3VyIDwgcmF0ZS50bykgJiYgIXNjaGVkdWxlW2hvdXJdLmluY2x1ZGVzKGRldmljZS5pZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Vyc1NjaGVkdWxlZCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlSW5Qb3dlcltob3VyXSArPSBkZXZpY2UucG93ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVbaG91cl0ucHVzaChkZXZpY2UuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVkRW5lcmd5LnZhbHVlICs9IHJhdGUudmFsdWUgKiAoZGV2aWNlLnBvd2VyIC8gMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRFbmVyZ3kuZGV2aWNlc1tkZXZpY2UuaWRdICs9IHJhdGUudmFsdWUgKiAoZGV2aWNlLnBvd2VyIC8gMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBob3VyKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3VtZWRFbmVyZ3kuZGV2aWNlc1tkZXZpY2UuaWRdID0gZml4RmxvYXQoY29uc3VtZWRFbmVyZ3kuZGV2aWNlc1tkZXZpY2UuaWRdKTtcbi8vIFxuICAgICAgICByZXR1cm4gZGV2aWNlXG4gICAgfSlcblxuICAgIGNvbnN1bWVkRW5lcmd5LnZhbHVlID0gZml4RmxvYXQoY29uc3VtZWRFbmVyZ3kudmFsdWUpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICAgIHNjaGVkdWxlLFxuICAgICAgICBjb25zdW1lZEVuZXJneVxuICAgIH07XG59XG5cbmNvbnN0IHJlc3VsdCA9IGNyZWF0ZVNjaGVkdWxlKGRhdGEpO1xuXG5jb25zb2xlLmxvZyhyZXN1bHQpOyIsImV4cG9ydCBkZWZhdWx0IHtcbiAgICBcImRldmljZXNcIjogW1xuICAgICAgICB7XG4gICAgICAgICAgICBcImlkXCI6IFwiRjk3MkI4MkJBNTZBNzBDQzU3OTk0NTc3M0I2ODY2RkJcIixcbiAgICAgICAgICAgIFwibmFtZVwiOiBcItCf0L7RgdGD0LTQvtC80L7QtdGH0L3QsNGPINC80LDRiNC40L3QsFwiLFxuICAgICAgICAgICAgXCJwb3dlclwiOiA5NTAsXG4gICAgICAgICAgICBcImR1cmF0aW9uXCI6IDMsXG4gICAgICAgICAgICBcIm1vZGVcIjogXCJuaWdodFwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIFwiaWRcIjogXCJDNTE1RDg4N0VEQkJFNjY5QjJGREFDNjJGNTcxRTlFOVwiLFxuICAgICAgICAgICAgXCJuYW1lXCI6IFwi0JTRg9GF0L7QstC60LBcIixcbiAgICAgICAgICAgIFwicG93ZXJcIjogMjAwMCxcbiAgICAgICAgICAgIFwiZHVyYXRpb25cIjogMixcbiAgICAgICAgICAgIFwibW9kZVwiOiBcImRheVwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIFwiaWRcIjogXCIwMkRERDIzQTg1REFEREQ3MTE5ODMwNTMzMENDMzg2RFwiLFxuICAgICAgICAgICAgXCJuYW1lXCI6IFwi0KXQvtC70L7QtNC40LvRjNC90LjQulwiLFxuICAgICAgICAgICAgXCJwb3dlclwiOiA1MCxcbiAgICAgICAgICAgIFwiZHVyYXRpb25cIjogMjRcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgXCJpZFwiOiBcIjFFNjI3NkNDMjMxNzE2RkU4RUU4QkM5MDg0ODZENDFFXCIsXG4gICAgICAgICAgICBcIm5hbWVcIjogXCLQotC10YDQvNC+0YHRgtCw0YJcIixcbiAgICAgICAgICAgIFwicG93ZXJcIjogNTAsXG4gICAgICAgICAgICBcImR1cmF0aW9uXCI6IDI0XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIFwiaWRcIjogXCI3RDlEQzg0QUQxMTA1MDBEMjg0QjMzQzgyRkU2RTg1RVwiLFxuICAgICAgICAgICAgXCJuYW1lXCI6IFwi0JrQvtC90LTQuNGG0LjQvtC90LXRgFwiLFxuICAgICAgICAgICAgXCJwb3dlclwiOiA4NTAsXG4gICAgICAgICAgICBcImR1cmF0aW9uXCI6IDFcbiAgICAgICAgfVxuICAgIF0sXG4gICAgXCJyYXRlc1wiOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIFwiZnJvbVwiOiA3LFxuICAgICAgICAgICAgXCJ0b1wiOiAxMCxcbiAgICAgICAgICAgIFwidmFsdWVcIjogNi40NlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBcImZyb21cIjogMTAsXG4gICAgICAgICAgICBcInRvXCI6IDE3LFxuICAgICAgICAgICAgXCJ2YWx1ZVwiOiA1LjM4XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIFwiZnJvbVwiOiAxNyxcbiAgICAgICAgICAgIFwidG9cIjogMjEsXG4gICAgICAgICAgICBcInZhbHVlXCI6IDYuNDZcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgXCJmcm9tXCI6IDIxLFxuICAgICAgICAgICAgXCJ0b1wiOiAyMyxcbiAgICAgICAgICAgIFwidmFsdWVcIjogNS4zOFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBcImZyb21cIjogMjMsXG4gICAgICAgICAgICBcInRvXCI6IDcsXG4gICAgICAgICAgICBcInZhbHVlXCI6IDEuNzlcbiAgICAgICAgfSxcbiAgICBdLFxuICAgIFwibWF4UG93ZXJcIjogMjEwMFxufTsiXSwic291cmNlUm9vdCI6IiJ9